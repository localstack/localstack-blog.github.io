<!doctype html><html lang=en-us><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="ie=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><link rel=stylesheet href=/css/vendor/custom.css><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-regular.woff2 type=font/woff2 crossorigin><link rel=preload as=font href=/fonts/vendor/jost/jost-v4-latin-700.woff2 type=font/woff2 crossorigin><link rel=stylesheet href=/main.b93f21975a8c509862bc461126163a533d1083c67ad9fe8621b9b49c72f22af2f868498b9be3305e5c0243d5b194d4e9df7ec3a49e44fa797de7700c870708a0.css integrity="sha512-uT8hl1qMUJhivEYRJhY6Uz0Qg8Z62f6GIbm0nHLyKvL4aEmLm+MwXlwCQ9WxlNTp337DpJ5E+nl953AMhwcIoA==" crossorigin=anonymous><noscript><style>img.lazyload{display:none}</style></noscript><meta name=robots content="index, follow"><meta name=googlebot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><meta name=bingbot content="index, follow, max-snippet:-1, max-image-preview:large, max-video-preview:-1"><title>Building LocalStack with LocalStack - LocalStack</title><meta name=description content="We are increasingly building various parts of the LocalStack Web Application using our core cloud emulator, leveraging numerous features for local cloud development. In this blog, we share how we are dogfooding our software to promote faster feature development and reduce inefficient testing loops."><link rel=canonical href=/2024-05-08-building-localstack-with-localstack/><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://blog.localstack.cloud/2024-05-08-building-localstack-with-localstack/building-localstack-with-localstack.png"><meta name=twitter:title content="Building LocalStack with LocalStack"><meta name=twitter:description content="We are increasingly building various parts of the LocalStack Web Application using our core cloud emulator, leveraging numerous features for local cloud development. In this blog, we share how we are dogfooding our software to promote faster feature development and reduce inefficient testing loops."><meta name=twitter:site content="@localstack"><meta name=twitter:creator content="@localstack"><meta property="og:title" content="Building LocalStack with LocalStack"><meta property="og:description" content="We are increasingly building various parts of the LocalStack Web Application using our core cloud emulator, leveraging numerous features for local cloud development. In this blog, we share how we are dogfooding our software to promote faster feature development and reduce inefficient testing loops."><meta property="og:type" content="article"><meta property="og:url" content="/2024-05-08-building-localstack-with-localstack/"><meta property="og:image" content="/2024-05-08-building-localstack-with-localstack/building-localstack-with-localstack.png"><meta property="article:published_time" content="2024-05-08T00:00:00+00:00"><meta property="article:modified_time" content="2024-05-08T00:00:00+00:00"><meta property="og:site_name" content="LocalStack"><meta property="article:publisher" content="https://www.facebook.com/"><meta property="article:author" content="https://www.facebook.com/"><meta property="og:locale" content="en_US"><script type=application/ld+json>{"@context":"http://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Home","item":"https:\/\/blog.localstack.cloud\/"},{"@type":"ListItem","position":3,"name":"2024 05 08 Building Localstack With Localstack","item":"https:\/\/blog.localstack.cloud\/\/2024-05-08-building-localstack-with-localstack\/"}]}</script><meta name=theme-color content="#fff"><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon.png><link rel=icon type=image/png sizes=32x32 href=/favicon-32x32.png><link rel=icon type=image/png sizes=16x16 href=/favicon-16x16.png><link rel=mask-icon href=/safari-pinned-tab.svg color=#6b7cf5><link rel=manifest href=/site.webmanifest><script>(function(a,e,f,g,b,c,d){a.GoogleAnalyticsObject=b,a[b]=a[b]||function(){(a[b].q=a[b].q||[]).push(arguments)},a[b].l=1*new Date,c=e.createElement(f),d=e.getElementsByTagName(f)[0],c.async=1,c.src=g,d.parentNode.insertBefore(c,d)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga'),ga('create','UA-101988473-1','auto'),ga('send','pageview')</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-QRFTZPWGB7"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-QRFTZPWGB7')</script><script defer src=https://unpkg.com/@tinybirdco/flock.js data-host=https://api.tinybird.co data-token=p.eyJ1IjogIjAwZDRjYzRjLTg4N2UtNGNmZS05YzY4LTJjNzMyNjE5ODdjMCIsICJpZCI6ICI2YzRhMDViNi1iZjVlLTRkY2QtODNlZS1jMmFjYjg5ZjQ1NzAifQ.EPdBzyAb28wUbtZacobblsMi42IwTd7d2amppDfw-jE></script><script type=text/javascript id=hs-script-loader async defer src=//js-eu1.hs-scripts.com/26596507.js></script><script type=text/javascript src=//js-eu1.hsforms.net/forms/embed/v2.js></script><script>function toggleTag(b){const c='tag-'+b;if(c!=='tag-all'){const a=document.getElementsByClassName('tag-all');for(let b=0;b<a.length;b++){const c=a[b];c.classList.add('d-none')}}const d=document.getElementsByClassName(c);for(let a=0;a<d.length;a++){const b=d[a];b.classList.remove('d-none')}const e=document.getElementsByClassName('filterButton');for(let a=0;a<e.length;a++){const b=e[a];b.classList.remove('bg-purple'),b.classList.remove('btn-primary'),b.classList.add('btn-outline-primary')}const f=b+"FilterButton",a=document.getElementById(f);a.classList.add('bg-purple'),a.classList.add('btn-primary'),a.classList.remove('btn-outline-primary')}</script></head><body class="page single"><header></header><section class="section section-sm bg-gradient-dark"><div class="position-absolute w-100 section pb-7 pt-7 d-none d-md-block"><div class=container><div class="row justify-content-center align-items-center"><div class=col-2><img class=w-100 style=transform:scale(2);opacity:.65 src=/images/heroes/blog.svg></div><div class=col-2></div><div class=col-2></div><div class=col-2><img class=w-100 style=transform:rotate(35deg)scale(1.4);opacity:.9 src=/images/heroes/blog.svg></div><div class=col-2><img class=w-100 style=transform:rotate(-45deg)scaleX(-1)scale(1.5);opacity:.75 src=/images/heroes/blog.svg></div></div></div></div><div class="container pb-5 pt-6 pb-md-7 pt-sm-7"><div class="row justify-content-center align-items-center text-white"><h1 class="text-center m-0 pt-lg-5">Building LocalStack with LocalStack</h1></div></div></section><section class="section section-sm mb-6"><div class="container px-lg-8"><div class="row justify-content-center"><div class=col-12><article><div class=blog-header><div class="d-flex align-items-center flex-wrap card-footer-text"><p class=mb-0><img src=/images/common/clock.svg>
16&nbsp;MIN READ&nbsp;&#8212;&nbsp;
posted May 8, 2024 by <a class="stretched-link position-relative">Lukas Pichler</a> and <a class="stretched-link position-relative">Harsh Mishra</a> and <a class="stretched-link position-relative">Vlad Gramuzov</a></p><p></div></div><p class=lead>We are increasingly building various parts of the LocalStack Web Application using our core cloud emulator, leveraging numerous features for local cloud development. In this blog, we share how we are dogfooding our software to promote faster feature development and reduce inefficient testing loops.</p><img class="img-simple img-fluid lazyload blur-up" src=/2024-05-08-building-localstack-with-localstack/building-localstack-with-localstack_hu37012c19b1d87c7ec57121c3980da4d0_336749_20x0_resize_box_2.png data-src=/2024-05-08-building-localstack-with-localstack/building-localstack-with-localstack.png width=1920 height=1080 alt="Banner image for the blog: Building LocalStack with LocalStack"><h2 id=introduction>Introduction</h2><p><a href=https://twitter.com/localstack/status/1181338405315256320>LocalStack Pro was announced in 2019</a>, shipping along with it the <a href=https://app.localstack.cloud>LocalStack Web application</a> to support developer toolings & features to make local cloud development a breeze. As our team expanded and we envisioned a broader scope for the LocalStack product, we started dogfooding our software to leverage the same features our customers use LocalStack for.</p><p><a href=https://docs.localstack.cloud/getting-started/installation/>LocalStack’s core cloud emulator</a> allows us to run our own cloud application - including its infrastructure - locally, which provides an efficient developer experience at the start of the entire software development lifecycle (SDLC). This experience enables us to build our product features in a way that closely matches what our customers are looking for — a comprehensive developer platform that facilitates local multi-cloud development across different providers and services.</p><p>In this blog, we highlight how we use the LocalStack core cloud emulator and other novel solutions, to build, test, and integrate new features in our LocalStack Web Application. We’ll also detail some of the lessons we have learned, recommendations for success, and how our experience has further helped us improve the base emulation layer.</p><ul><li><a href=#application-overview>Application Overview</a></li><li><a href=#how-do-we-enable-local-cloud-development>How do we enable local cloud development?</a></li><li><a href=#how-do-we-use-localstack-in-ci>How do we use LocalStack in CI?</a></li><li><a href=#how-do-we-use-localstack-to-enable-application-previews-and-e2e-testing>How do we use LocalStack to enable application previews and E2E testing?</a></li><li><a href=#conclusion>Conclusion</a></li></ul><h2 id=application-overview>Application Overview</h2><p>The LocalStack Web Application comprises two central components — the client Web application and the related backend. Our whole infrastructure is hosted on <a href=https://aws.amazon.com/>Amazon Web Services (AWS)</a> and is deployed using the <a href=https://aws.amazon.com/cdk/>Cloud Development Kit (CDK)</a>. We use various AWS services, such as <a href=https://aws.amazon.com/lambda/>Lambda</a>, <a href=https://aws.amazon.com/s3/>S3</a>, <a href=https://aws.amazon.com/sns/>SNS</a>, <a href=https://aws.amazon.com/sqs/>SQS</a>, <a href=https://aws.amazon.com/cloudfront/>CloudFront</a>, <a href=https://aws.amazon.com/dynamodb/>DynamoDB</a>, <a href=https://aws.amazon.com/ecs/>ECS</a>, <a href=https://aws.amazon.com/ec2/>EC2</a>, <a href=https://aws.amazon.com/cognito/>Cognito</a>, <a href=https://aws.amazon.com/secrets-manager/>Secrets Manager</a>, to name just a few. We use <a href=https://react.dev/>ReactJS</a> & Typescript for our client application while using <a href=https://flask.palletsprojects.com/en/3.0.x/>Flask</a> & Python for the backend.</p><img class="img-simple img-fluid lazyload blur-up" src=/2024-05-08-building-localstack-with-localstack/web-application-architecture_hu577d6cc9c07124bc9581b9accb1b5607_166524_20x0_resize_box_2.png data-src=/2024-05-08-building-localstack-with-localstack/web-application-architecture.png width=1920 height=809 alt="LocalStack Web Application architecture"><p>The complexity of our cloud infrastructure and various managed dependencies mean that there is no straightforward way of testing it. While <a href=https://docs.aws.amazon.com/prescriptive-guidance/latest/best-practices-cdk-typescript-iac/development-best-practices.html>AWS’s official recommendations</a> push us forward to using fine-grained assertions and snapshot tests, there are inherent limitations and hurdles such as protracted deployment periods and expensive cloud resources.</p><h2 id=how-do-we-enable-local-cloud-development>How do we enable local cloud development?</h2><p>When we started our cloud application development, we had a long test and release process that used a dedicated staging environment to test the latest changes and make adjustments before moving them to production. By allowing us to develop our application entirely on our developer machines, we reduced the time spent waiting for feedback, as there are no real resources or deployment involved.</p><p>This section will detail parts of our setup to help you implement a similar local development flow.</p><h3 id=boto3-configuration>Boto3 Configuration</h3><p>Our Flask backend connects to various AWS resources using <code>boto3</code> - the <a href=https://aws.amazon.com/sdk-for-python/>official AWS SDK for Python</a>. To integrate LocalStack, we use a simple configuration when creating the <code>boto3</code> client. This configuration determines if <code>boto3</code> connects to LocalStack during development or to actual AWS services in staging/production environments.</p><p>We use <a href=https://www.dynaconf.com/>Dynaconf</a> for configuration management, enabling us to set different settings for each environment. The following example shows the default AWS settings for production:</p><pre><code class=language-bash>[default]
aws.endpoint_url = &quot;&quot;
</code></pre><p>For local development, we point <code>boto3</code> to LocalStack by setting the AWS endpoint URL to LocalStack&rsquo;s address:</p><pre><code class=language-bash>[development]
aws.endpoint_url = &quot;http://localhost.localstack.cloud:4566&quot;
</code></pre><p>These variables are used when creating the boto3 client as follows:</p><pre><code>def get_aws_config(self) -&gt; AWSClientConfig:
    endpoint_url = None

    if settings.get(&quot;aws.endpoint_url&quot;):
        endpoint_url = settings.get(&quot;aws.endpoint_url&quot;)

    return AWSClientConfig(
        endpoint_url=endpoint_url,
    )

class LambdaClient(AWSClient):
    def __init__(self, config: AWSClientConfig):
        config = get_aws_config()
        self.client = boto3.client(&quot;lambda&quot;, config.dict())
</code></pre><p>This setup routes all <code>boto3</code> calls in our backend to LocalStack instead of real AWS services when developing locally.</p><h3 id=infrastructure-deployment>Infrastructure deployment</h3><p>With the configuration described earlier, we connected the Python backend to local resources on LocalStack, such as DynamoDB. However, our infrastructure includes serverless services like Lambdas, ECS, and EC2. The next logical step was to deploy the entire infrastructure onto LocalStack to develop and test the whole application locally.</p><p>We are using <a href=https://github.com/localstack/aws-cdk-local><code>cdklocal</code></a>, our open-source wrapper script around the CDK library, to deploy our CDK stacks against LocalStack - our core cloud emulator. To achieve this, we first bootstrap the environment and deploy the backend stack afterwards.</p><pre><code class=language-bash>cd backend
export AWS_ACCOUNT_ID=000000000000 AWS_DEFAULT_REGION=eu-central-1
cdklocal bootstrap aws://$AWS_ACCOUNT_ID/$AWS_DEFAULT_REGION
cdklocal deploy --require-approval=never 
</code></pre><p>This set of commands is wrapped up in a single Makefile target, which can then be invoked with one CLI command:</p><pre><code class=language-bash>make deploy-local
</code></pre><p>To deploy the frontend to LocalStack as well, we have a similar sequence of commands:</p><pre><code class=language-bash>cd ../frontend
cdklocal deploy --require-approval=never
</code></pre><p>The key tenet of our local cloud development model is agility — deploying our CDK stack on AWS for development & testing <strong>used to take around 15 minutes</strong>. With LocalStack, we were able to cut it down to <strong>less than sixty seconds</strong>. It enables a quick feedback loop and and confidence that <em>our app runs locally!</em> while ensuring we are not handcuffed, as we deploy our applications dozens of times a day locally.</p><img class="img-simple img-fluid lazyload blur-up" src=/2024-05-08-building-localstack-with-localstack/localstack-web-app-running-locally_hu27ba3915814399e03bce184c3e26a80b_798856_20x0_resize_box_2.png data-src=/2024-05-08-building-localstack-with-localstack/localstack-web-app-running-locally.png width=2560 height=1413 alt="LocalStack Web App running locally"><h3 id=testing>Testing</h3><p>With the ability to deploy our application locally, we can develop and test various flows manually, for example, if one can sign up, which involves Cognito and a few Lambdas.</p><p>Deploying the application locally further allows us to run our integration test suite against it. This includes testing end-to-end flows that involve Lambdas and SQS queues, Cognito triggers and authentication flows, and a DynamoDB-powered persistence layer with asynchronous stream handlers. The local integration suite enables us to eliminate cloud-based developer environments and use emulated resources to test our infrastructure locally with the highest level of fidelity.</p><p>For example, in the signup process, our application logic performs the following steps:</p><ul><li>Create a new user in the database.</li><li>Create a user in Cognito.</li><li>Send an email to the user to confirm their account creation.</li></ul><p>With our infrastructure deployed, which we set up before running our test suite, we use pytest to implement tests that assert the behaviors described above.</p><pre><code class=language-python>def test_signup_user(self, smtp_server):
    user_email = f&quot;{short_uid()}@localstack.cloud&quot;

    response = requests.post(
        url=API_PATH_SIGNUP, # path that points to signup endpoint
        json=dict(
            email=user_email,
            password=&quot;TestingPassword123!&quot;,
        ),
    )

    assert response.status_code == 200
    assert response.json[&quot;id&quot;] is not None
    assert response.json[&quot;email&quot;] == user_email

    user_exists = cognito_client.admin_get_user(
      UserPoolId=USER_POOL_ID, # user pool id for cognito
      Username=user_email
    )
    assert user_exists is not None

    messages = smtp_server.list_messages()
    assert len(messages) == 1
    assert messages[0]['Subject'] == 'LocalStack Account Activation'
</code></pre><h3 id=development--debugging>Development & debugging</h3><p>Apart from this, we further wanted to leverage LocalStack’s debugging tools in our development process. We were able to incorporate <a href=https://docs.localstack.cloud/user-guide/lambda-tools/hot-reloading/>Lambda Hot Reloading</a> & <a href=https://docs.localstack.cloud/user-guide/aws/ecs/#mounting-local-directories-for-ecs-tasks>ECS Code Mounting</a>.</p><p>With just a few of many LocalStack features, we streamline our developer experience and improve the local development setup even further:</p><ul><li>Our infrastructure, which includes our Lambdas, is deployed in hot-reload mode. This setup enables LocalStack to monitor the Lambdas for any changes.</li><li>We can trigger these Lambdas during integration tests, manually, or through the locally running web application.</li><li>We can make on-the-fly changes to the function, and subsequent executions of the affected Lambda will change depending on the adjustments made.</li></ul><p>This is especially useful during development and with our extensive integration test suites, as developers can iterate quickly without waiting for code changes to be applied.</p><p>The following lines of code enable our CDK stack to utilize the Hot Reloading feature mentioned above:</p><pre><code class=language-python>lambda_bucket = s3.Bucket.from_bucket_name(scope, f&quot;lambda_name_local&quot;, &quot;hot-reload&quot;)
lambda_code = lambda_.Code.from_bucket(bucket=lambda_bucket, key=HOT_RELOADED_CODE_PATH) # path pointing to our root project directory
</code></pre><p>Our team furthermore benefits from hot-reloading qualities by incorporating LocalStack’s ECS features. We can mount our backend code from the host filesystem into the ECS containers. Similar to Lambda Hot Reloading it makes development a breeze, enabling faster development loops and increased debuggability where the changes are made without having to build and (re-) deploy any infrastructural changes or even Docker images each time.</p><p>Here is an example, where we register a task definition, mounting the host path <code>./localstack_platform</code> into the container under <code>/app/localstack_platform</code>:</p><pre><code class=language-python3>task_def = ecs.TaskDefinition(
        ...
        volumes=[
                ecs.Volume(name=&quot;test-volume&quot;, host=ecs.Host(source_path=&quot;./localstack_platform&quot;))
        ]
)

platform_container = task_def.add_container(...)

platform_container.add_mount_points(
        ecs.MountPoint(
                container_path=&quot;/app/localstack_platform&quot;,
                source_volume=&quot;test-volume&quot;,
                read_only=False,
        ),
)
</code></pre><p>The CDK enhancements are wrapped in what we call &ldquo;if-local blocks,&rdquo; which are only executed when CDK detects that it is in a local environment.</p><pre><code class=language-python>if is_local_development:
  # Do something that's only needed for the local deployment
</code></pre><p>Of course, we don&rsquo;t want similar mount points for ECS tasks or buckets named <code>hot-reload</code> in production, so be sure to use &ldquo;if-local blocks&rdquo; where necessary!</p><h3 id=localstack-extensions>LocalStack Extensions</h3><p><a href=https://docs.localstack.cloud/user-guide/extensions/>LocalStack Extensions</a> provides a straightforward way to start custom service emulators together with LocalStack. As part of our effort to improve the user experience for extensions, we have released a couple of new extensions that we also actively use internally.</p><p>Our development & testing workflows make use of the <a href=https://pypi.org/project/localstack-extension-stripe/>Stripe</a> and <a href=https://pypi.org/project/localstack-extension-mailhog/>Mailhog</a> extensions - both locally and in CI. We configure LocalStack to start with these extensions automatically by setting the following environment variable:</p><pre><code class=language-bash>EXTENSION_AUTO_INSTALL=localstack-extension-mailhog,localstack-extension-stripe
</code></pre><p>The LocalStack Web Application handles various aspects of account management, such as Purchases, Subscriptions, Billing, and more. The Stripe extension fully allows us to test these flows, using an emulated Stripe service that runs on our machines locally. With the Stripe extension, we can now test user flows like purchasing a subscription or updating billing details, and other Stripe API operations.</p><p>Routing the calls to the locally running Stripe emulator is achieved by making use of Dynaconf again, which sets the API endpoint of the <a href=https://docs.stripe.com/libraries>Stripe SDK</a> to the local Stripe extension, during development.</p><pre><code class=language-python>[default]
stripe.api_base = &quot;https://api.stripe.com&quot;

[development]
stripe.api_base = &quot;http://localhost.localstack.cloud:8420&quot;
</code></pre><p>When initializing our Stripe provider, we simply override the API endpoint of the <a href=https://docs.stripe.com/libraries>Stripe SDK</a> with the value in our Dynaconf config, and hence can split the application code from different environments.</p><p>In the case of testing our checkout flow, which means purchasing a subscription, calls to Stripe are automatically routed to the locally running extension, and we can afterwards check whether postconditions are fulfilled - all done locally.</p><pre><code class=language-python>def test_subscribe(self):
    subscription = self.stripe_provider.subscribe(
        plan=TeamPlan,
    )
    assert subscription
    assert subscription.plan.id == TeamPlan.id
    ...
</code></pre><p>The Mailhog extension allows us to emulate a local email server for testing user flows that require our platform to send emails, such as account activation, trial expiry notifications, and much more. Using this extension automatically configures LocalStack to use the Mailhog SMTP server when sending emails over SES.</p><p>This means that any email we send from our application logic ends up in the mailbox of Mailhog, which we can then either view via the user interface or fetch via the API that comes with the extension.</p><p>After instructing LocalStack to start with the Mailhog extension, it automatically starts the Mailhog service on port 25. Then, we just need to adjust our application to connect to the SMTP host running on port 25 locally, again with the help of Dynaconf.</p><pre><code class=language-python>[default]
smpt_host = &quot;email-smtp.eu-central-1.amazonaws.com:587&quot;

[development]
smpt_host = &quot;localhost.localstack.cloud:25&quot;

# used in application code:

s = self._connect_smtp(smtp_host, smtp_user, smtp_pass)
s.sendmail()
</code></pre><p>On below image you can see the user interface of the Mailhog extension, displaying the email which is sent when signing up for an account.</p><img class="img-simple img-fluid lazyload blur-up" src=/2024-05-08-building-localstack-with-localstack/localstack-mailhog-extension_hu58e5766d23ae691f4102362a55a85e9d_143379_20x0_resize_box_2.png data-src=/2024-05-08-building-localstack-with-localstack/localstack-mailhog-extension.png width=1816 height=1088 alt="LocalStack Mailhog extension"><p>An example on how we write tests against Mailhog has been given in the previous section called <a href=#testing>Infrastructure deployment & testing</a>.</p><h2 id=how-do-we-use-localstack-in-ci>How do we use LocalStack in CI?</h2><p>By running our cloud deployment & test suite locally, we were able to demystify the pain points of the local cloud developer experience, which further helped us improve the parity, performance, and robustness of our core cloud emulator. However, we wanted to extend that improved developer experience across continuous integration (CI) pipelines with LocalStack. While it is easy just to use LocalStack as a drop-in replacement for AWS, and run our test suites just like we do it locally, it is hard to retrieve detailed API telemetry, critical analytics, and discover flaky tests that need remediation.</p><p>This led us to embark on a journey to identify the missing puzzle pieces in the LocalStack CI experience. It made us build internal homegrown systems, which have now spun into LocalStack features that we continue to leverage for our CI pipelines.</p><h3 id=localstack-github-action>LocalStack GitHub Action</h3><p>We primarily use <a href=https://github.com/features/actions>GitHub Actions</a> to build, deploy, and test our web application & backend. Previously, setting up LocalStack on GitHub Actions (or any CI provider in general) was a pain, which required pulling the Docker image, installing the <code>localstack</code> CLI and other associated tools, before you could start LocalStack. To simplify this process, we created the <a href=https://github.com/localstack/setup-localstack><code>setup-localstack</code> GitHub Action</a> which:</p><ul><li>Pulls the <code>latest</code> - or a specific - version of the LocalStack Docker image</li><li>Installs the <code>localstack</code> CLI alongside setting up configurations & wrapper scripts</li><li>Starts the LocalStack container with or without the pro capabilities, depending on whether a valid CI Key is provided</li></ul><p>The GitHub Action allowed us to set up LocalStack and related tooling for running our test suite in CI by using a simple workflow step:</p><pre><code class=language-yaml>- name: Start LocalStack
  uses: LocalStack/setup-localstack@v0.1.2
  with:
    image-tag: 'latest'
    use-pro: 'true'
    configuration: EXTRA_CORS_ALLOWED_ORIGINS=*
  env:
    LOCALSTACK_API_KEY: ${{ secrets.LOCALSTACK_API_KEY }}
</code></pre><h3 id=state-snapshots-with-cloud-pods>State Snapshots with Cloud Pods</h3><p>LocalStack by default is ephemeral, which means that all state is gone when the container is stopped. However, we wanted to leverage our mechanism that can restore the emulator to a particular state before we run our tests against it to enable various test scenarios. This is possible with two options:</p><ul><li>Running an initialization hook or an infrastructure-as-code (IaC) deployment against the emulator.</li><li>Using a state snapshot that restores a previously-created state and pre-seed it in a test environment.</li></ul><p><a href=https://docs.localstack.cloud/user-guide/state-management/persistence/>LocalStack’s persistence mechanism</a> (enabled via <code>PERSISTENCE=1</code>) was useful for local development & testing needs. However, we further wanted to leverage state snapshots that can be stored, versioned, and shared across different development & testing environments. <a href=https://docs.localstack.cloud/user-guide/state-management/cloud-pods/>Cloud Pods</a> are a mechanism to save LocalStack state onto a remote backend, allowing to restore infrastructure and state of various services when required.</p><img class="img-simple img-fluid lazyload blur-up" src=/2024-05-08-building-localstack-with-localstack/persistence-state-cloud-pods_hu14ac2f60125c988298a465079699b7e0_768278_20x0_resize_box_2.png data-src=/2024-05-08-building-localstack-with-localstack/persistence-state-cloud-pods.png width=3840 height=2160 alt="LocalStack Persistence vs Cloud Pods"><p>Using Cloud Pods, we were able to cut down the total infrastructure deployment time <strong>from a minute to less than 10 seconds</strong>, both locally and in our CI pipelines. To maintain an up-to-date version of the Cloud Pod, we have a GitHub action which creates a pod with the latest infrastructure, that’s triggered on each merge to the <code>main</code> branch. We then use that pod in combination with our <a href=https://docs.localstack.cloud/user-guide/state-management/cloud-pods/#environmental-variables>auto-loading Cloud Pods</a> feature, which allows us to load cloud pods on the start-up of LocalStack automatically.</p><pre><code class=language-yaml>AUTO_LOAD_POD=localstack-backend-pod
</code></pre><p>Now, when LocalStack starts up, our entire backend loads from the Cloud Pod, allowing us to perform various tests locally and in CI.</p><p>This setup is also extremely beneficial for our frontend engineers, as they don&rsquo;t need to start or install any backend dependencies on their machines. They simply use our up-to-date pod and LocalStack to develop the customer-facing UI.</p><h3 id=continuous-integration-ci-analytics>Continuous Integration (CI) Analytics</h3><p>With the LocalStack v3 release, we released a private preview of our <a href=https://docs.localstack.cloud/user-guide/ci/ci-analytics/>CI Analytics</a> feature. CI Analytics allow us to collect, analyze, and visualize critical metrics from our CI pipelines, helping us understand the execution of our test suites in CI builds and related outcomes.</p><img class="img-simple img-fluid lazyload blur-up" src=/2024-05-08-building-localstack-with-localstack/ci-analytics_hu63559209482ee5f38a128aebf23d5758_951936_20x0_resize_box_2.png data-src=/2024-05-08-building-localstack-with-localstack/ci-analytics.png width=3104 height=1836 alt="LocalStack CI Analytics"><p>This allowed us to get detailed insights and traceability across our CI pipeline run by:</p><ul><li>Recording all interactions throughout a CI build to get a detailed timeline of API calls using Stack Insights.</li><li>Select and drill into the infrastructure & application state at a particular point of execution using Cloud Pods.</li><li>Correlate the timeline of API calls with state changes, to identify hot spots and defect root causes.</li></ul><p>This can be enabled by just setting a simple configuration variable in your LocalStack GitHub Action (or any other CI provider in general):</p><pre><code class=language-yaml>LS_CI_PROJECT=name-of-your-project
</code></pre><p>With CI Analytics we can drill down into the request & response traces for every AWS API call that we make with our integration test suite. With the help of CI Analytics, we have brought together the critical missing pieces of CI observability & analytics into one single feature which has massively improved our CI troubleshooting and debugging experience.</p><p>Additionally, we can now instrument the important paths and processes, capture the infrastructure state which can be restored locally, and enrich our API telemetry to capture relevant data that help our developers understand flaky CI tests.</p><img class="img-simple img-fluid lazyload blur-up" src=/2024-05-08-building-localstack-with-localstack/ci-analytics-request-reponse-traces_hu15db7aa9a0fee604128ef20810756a1f_2452344_20x0_resize_box_2.png data-src=/2024-05-08-building-localstack-with-localstack/ci-analytics-request-reponse-traces.png width=3680 height=2228 alt="CI Analytics Page showing the request/response traces"><h2 id=how-do-we-use-localstack-to-enable-application-previews-and-e2e-testing>How do we use LocalStack to enable application previews and E2E testing?</h2><p>After running our integration tests, both locally and in CI, the next step was to deploy the CDK stack in our staging environment. The staging environment allowed us to run our end-to-end (E2E) integration test suite, which relies on the Playwright framework, and further use it for acceptance testing, to get alignment across cross-departmental projects. It allowed us to achieve the final degree of validation before we shipped a new release to production.</p><p>With the LocalStack v3 release, we released a private preview of <a href=https://docs.localstack.cloud/user-guide/cloud-sandbox/ephemeral-instance/>Ephemeral Instances</a>. These ephemeral instances allow us to run a short-lived encapsulated instance of LocalStack in the cloud. It allows us to run our E2E tests, preview features in our cloud application, and collaborate asynchronously within and across the team.</p><img class="img-simple img-fluid lazyload blur-up" src=/2024-05-08-building-localstack-with-localstack/ephemeral-instances_hu63559209482ee5f38a128aebf23d5758_857444_20x0_resize_box_2.png data-src=/2024-05-08-building-localstack-with-localstack/ephemeral-instances.png width=3104 height=1836 alt="LocalStack Ephemeral Instances"><p>With these ephemeral instances, we can now deploy our entire application (frontend, backend, and infrastructure) on an ephemeral instance, and expose the instance to us internally, which allows us to test our changes with every pull request. This has allowed us to replace our staging environment with ephemeral instances, which we use to continuously run automated tests and check out individual features in parallel manually.</p><p>Here is how we configured our GitHub Action pipeline to spin up an ephemeral instance for our application changes with every pull request:</p><pre><code class=language-yaml>steps:
  - name: Checkout
    uses: actions/checkout@v4

  - name: Deploy Preview
    uses: LocalStack/setup-localstack/preview@main
    with:
      github-token: ${{ secrets.GITHUB_TOKEN }}
      localstack-api-key: ${{ secrets.LOCALSTACK_API_KEY }}
      preview-cmd: |
        npm install -g aws-cdk-local aws-cdk
        pip install awscli-local[ver1]
        make deploy-local

  - name: Finalize PR comment
    uses: LocalStack/setup-localstack/finish@main
    with:
      github-token: ${{ secrets.GITHUB_TOKEN }}
      include-preview: true
</code></pre><p>This enables us to:</p><ul><li>Foster active collaboration with GTM, RevOps, and DevRel teams to demonstrate new features to prospective customers.</li><li>Remove the need for staging environments, by giving every engineer an isolated environment, essentially unblocking ourselves.</li><li>Cut down costs around our staging environment by tearing down environments automatically, which avoids unnecessary cloud costs.</li></ul><img class="img-simple img-fluid lazyload blur-up" src=/2024-05-08-building-localstack-with-localstack/ephemeral-preview-pull-request-comment_hud2d6b749efd288cb4acbe456dc3e706b_23643_20x0_resize_box_2.png data-src=/2024-05-08-building-localstack-with-localstack/ephemeral-preview-pull-request-comment.png width=920 height=160 alt="A PR comment displaying the Ephemeral Instance URL"><p>Though application previews have been ubiquitous in the frontend space, LocalStack can now spin up your entire application, including any infrastructure relying on AWS services, and ship you a live deployment with every change. This first-class preview-on-pull request support is instrumental in helping LocalStack become a true cloud development platform — not only for developers but also for QA & management, to fully become the backbone of cloud development throughout the entire SDLC.</p><h2 id=conclusion>Conclusion</h2><p>That’s the long and short of how we are building LocalStack with LocalStack. LocalStack has enabled rapid design and development of sophisticated solutions by reducing the number of test and UAT environments while improving the quality and lead time. The best way we can improve our product is to iteratively adopt it, and ensure we can leverage the same features as our customers do and continue to nail down the developer experience. Over many months, we have continued to ship improvements to enable teams, like ours, to scale and mitigate common bottlenecks while developing on the cloud.</p><p>As we continue our work in fleshing out the LocalStack experience, we aim to further support enterprise compliance & insights, with features like Chaos engineering, Productivity metrics, Cost optimizations, and more. This will allow us to expand from our initial focus on the inner dev loop to an outer dev loop experience, to accelerate your cloud journey and to put developers back in charge. Building a high-fidelity cloud emulator has been a challenging undertaking, but this strong foundation sets us up towards solving larger problems at hand — state management, SDLC, collaboration, and more.</p><p>Stay tuned for more news and awesome features in the upcoming months — or if you would like to get access to some of the features we’ve been using, <a href=https://localstack.cloud/contact/>get in touch with us</a>!</p><div class="blog-cta-1 text-center"><div class="ls-badge text-uppercase d-inline-block">Get in Touch</div><h2 class=heading>Ready to get started developing and testing your cloud apps offline?</h2><a class="btn btn-white text-uppercase" data-bs-toggle=collapse href=#collapseContact role=button aria-expanded=false aria-controls=collapseContact>Request a Demo</a><div class=collapse id=collapseContact><div class="overlay-card h-100 p-4 p-md-5 p-lg-6 mt-4"><script>hbspt.forms.create({region:"eu1",portalId:"26596507",formId:"fcc8c7e6-09cf-4364-8fe6-b6e616130bfa"})</script></div></div></div></article></div></div></div></section><section class="section bg-gradient-light"><div class=container><div class="row justify-content-center"><div class="d-flex flex-column gap-4 col-lg-12 text-white"><h2 class="h2 text-center">Stay in the loop</h2><p>We'd love to get in touch with you.
Please subscribe with your email to stay tuned for release notes and product updates.
We promise never to send an excessive amount of emails (we hate spam, too).</p><script>hbspt.forms.create({region:"eu1",portalId:"26596507",formId:"1cc99237-4ce0-4d65-abdf-f87ac2724717"})</script></div></div></div></section><footer class="footer pt-6 bg-gradient-dark"><div class="footer-main pb-5"><div class=container><div class="row justify-content-between"><div class="col-12 col-lg-4"><img style=width:243px src=/images/header-logo-new.svg alt="LocalStack Logo"></div><div class="col-12 col-lg-8 mt-4 mt-lg-0"><div class="row gap-4"><div class=col><ul class="list-unstyled gap-4 d-flex flex-column"><li><a class=footer-text href=https://localstack.cloud/contact>Contact</a></li><li><a class=footer-text href=https://localstack.cloud/careers>Careers</a></li><li><a class=footer-text href=https://blog.localstack.cloud>Blog</a></li><li><a class=footer-text href=https://docs.localstack.cloud>Docs</a></li></ul></div><div class=col><ul class="list-unstyled gap-4 d-flex flex-column"><li><a class=footer-text href=https://docs.localstack.cloud/tutorials/>Tutorials</a></li><li><a class=footer-text href=https://docs.localstack.cloud/applications/>Applications</a></li><li><a class=footer-text href=https://docs.localstack.cloud/academy/>LocalStack Academy</a></li></ul></div><div class=col><ul class="list-unstyled gap-4 d-flex flex-column"><li><a class=footer-text href=https://www.localstack.cloud/legal/tos>Terms and Conditions</a></li><li><a class=footer-text href=https://www.localstack.cloud/legal/privacy-policy>Privacy Policy</a></li><li><a class=footer-text href=https://assets-global.website-files.com/6539036f80ddc9e9a467134e/657b15a7f5ba23e41984d5dd_LocalStack%20DPA.pdf>Data Processing Addendum</a></li></ul></div><div class=col><ul class="list-unstyled gap-4 d-flex flex-column"><li class=footer-text>Follow us</li><li class="d-flex gap-3"><a class=footer-text href=https://twitter.com/localstack><span><svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M25 13.25c0 6.9036-5.5964 12.5-12.5 12.5C5.59644 25.75.0 20.1536.0 13.25.0 6.34644 5.59644.75 12.5.75 19.4036.75 25 6.34644 25 13.25zm-6.56-3.0468C19.0443 10.1315 19.6205 9.97084 20.1562 9.73331 19.7558 10.3325 19.2493 10.8586 18.6651 11.2797 18.6709 11.4076 18.6738 11.5366 18.6738 11.6661c0 3.9487-3.0055 8.5014-8.5012 8.5014C8.48534 20.1675 6.91443 19.6731 5.59285 18.825 5.82615 18.8528 6.06457 18.8669 6.30522 18.8669 7.70545 18.8669 8.9936 18.3894 10.0164 17.5879 8.70861 17.5636 7.6054 16.6997 7.22527 15.5129 7.40754 15.5477 7.59449 15.5662 7.78745 15.5662 8.05952 15.5662 8.32401 15.5299 8.57447 15.4612c-1.36658-.2743-2.39692-1.4817-2.39692-2.9294C6.17755 12.5193 6.17755 12.5066 6.17777 12.4939 6.58041 12.7183 7.04144 12.8526 7.53098 12.868 6.7297 12.3323 6.20183 11.4174 6.20183 10.3811c0-.547520000000001.14751-1.06113.40465-1.50232C8.08024 10.687 10.282 11.8764 12.7651 12.001 12.7139 11.7822 12.6874 11.5542 12.6874 11.32c0-1.64975 1.338-2.98781 2.9878-2.98781.8599.0 1.6364.36276 2.1815.94322C18.5369 9.14149 19.1767 8.89304 19.754 8.55056 19.5305 9.24867 19.057 9.83358 18.44 10.2032z" fill="#fff"/></svg></span></a><a class=footer-text href=https://www.linkedin.com/company/localstack-cloud><span><svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M13 26c7.1797.0 13-5.8203 13-13S20.1797.0 13 0 0 5.8203.0 13 5.8203 26 13 26zM9.35126 10.5024C9.97963 10.5024 10.489 9.993 10.489 9.36463S9.97963 8.22687 9.35126 8.22687 8.2135 8.73626 8.2135 9.36463s.50939 1.13777 1.13776 1.13777zm2.21194.8622v6.3122h1.9599V14.5553C13.5231 13.7316 13.6781 12.9339 14.6993 12.9339c1.0073.0 1.0198.941700000000001 1.0198 1.6734v3.0701H17.68V14.2157C17.68 12.5153 17.3139 11.2086 15.3265 11.2086c-.9542.0-1.5938.5236-1.8554 1.0192H13.4446V11.3646H11.5632zm-3.19382.0H10.3324v6.3122H8.36938V11.3646z" fill="#fff"/></svg></span></a></li></ul></div></div></div></div></div></div><div class=footer-bottom><div class="container mb-2"><hr><div class="row pt-4"><div class=col style=color:#fff;opacity:.5>Copyright &copy; LocalStack</div><div class="col text-end"><ul class=list-inline></ul></div></div></div></div></footer><script src=/js/bootstrap.min.51b4083a09e54138d5bbe9c42a5f5f71af6e60a417f276d5620cbde3b15eb1a07c9ea17a889bc58074adf9b19641039a77521d3131f039300d2fe29ffa532aa8.js integrity="sha512-UbQIOgnlQTjVu+nEKl9fca9uYKQX8nbVYgy947FesaB8nqF6iJvFgHSt+bGWQQOad1IdMTHwOTANL+Kf+lMqqA==" crossorigin=anonymous defer></script><script src=/js/highlight.min.8cdbefd08ec63ef25f4b2510ae50c13b3d9ed43e25a15ddb55f14c33130e68cf8be3131ccf2d087c49f5f21fe88c2f0e2715a21f936047d0d0b85dc48cb864b9.js integrity="sha512-jNvv0I7GPvJfSyUQrlDBOz2e1D4loV3bVfFMMxMOaM+L4xMczy0IfEn18h/ojC8OJxWiH5NgR9DQuF3EjLhkuQ==" crossorigin=anonymous defer></script><script src=/main.min.8933efb6bcdc37606a11f732d52c6f65d7fc1d082b89d56516f6a1bfb528ee7c40c3430bb80214cdd129ec7d69d4cadd74e693da54a9ba6f08c44771204d4468.js integrity="sha512-iTPvtrzcN2BqEfcy1SxvZdf8HQgridVlFvahv7Uo7nxAw0MLuAIUzdEp7H1p1MrddOaT2lSpum8IxEdxIE1EaA==" crossorigin=anonymous defer></script><script src=/index.min.28297aad85d5f5902201eb4ef84e7012a37d4a34824e2256df80cd91e547bf155df22029e5596951d6f2692dd1fee54c76721b407e5ac526bd33bedc636a87e5.js integrity="sha512-KCl6rYXV9ZAiAetO+E5wEqN9SjSCTiJW34DNkeVHvxVd8iAp5VlpUdbyaS3R/uVMdnIbQH5axSa9M77cY2qH5Q==" crossorigin=anonymous defer></script></body></html>